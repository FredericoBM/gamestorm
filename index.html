<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameStorm | Sua Arena de Jogos</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <nav class="navbar">
            <div class="logo">GAME<span>STORM</span></div>
            <ul class="nav-links">
                <li><a href="index.html">Início</a></li>
                <li><a href="#">Populares</a></li>
                <li><a href="#">Categorias</a></li>
                <li><a href="#">Comunidade</a></li>
            </ul>
            
            <div class="nav-auth" id="auth-container">
                <a href="login.html" id="login-link" style="color: white; text-decoration: none; font-weight: 600;">Entrar</a>

                <div id="user-profile" style="display: none; align-items: center; gap: 12px; position: relative; cursor: pointer;">
                    <span id="user-name" style="font-weight: 600; color: var(--primary);">Carregando...</span>
                    <div class="user-avatar" style="width: 35px; height: 35px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; box-shadow: 0 0 10px var(--primary-glow);">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    
                    <div id="user-dropdown" style="display: none; position: absolute; top: 110%; right: 0; background: #1a1a1a; border: 1px solid #333; padding: 10px; border-radius: 8px; min-width: 140px; z-index: 1000; box-shadow: 0 10px 20px rgba(0,0,0,0.5);">
                        <a href="#" id="logout-btn" style="color: #ff4d4d; text-decoration: none; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                            <i class="fa-solid fa-right-from-bracket"></i> Sair da Arena
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1>O Jogo do Momento</h1>
            <p>Explore novos mundos, conquiste territórios e desafie seus limites na arena mais épica da web.</p>
            <button class="btn-main">JOGAR AGORA <i class="fa-solid fa-play" style="margin-left: 10px;"></i></button>
        </div>
    </section>

    <section class="search-container">
        <div class="search-box">
            <input type="text" placeholder="O que você quer jogar hoje?">
            <button>Perguntar</button>
        </div>
    </section>

    <main class="container">
        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="font-size: 1.8rem;">Jogos Recomendados</h2>
            <a href="#" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Ver todos →</a>
        </div>
        
        <div class="game-grid">
            <div class="game-card">
                <div class="game-thumb" style="background-image: url('https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&w=400&q=80')"></div>
                <div class="game-info">
                    <h3>Cyber Quest</h3>
                    <p style="color: var(--text-dim); font-size: 0.85rem;">Ação / RPG / Sci-Fi</p>
                    <button class="play-btn">Jogar</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // IMPORTANTE: Substitua pelos dados REAIS do seu Firebase Console
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "seu-projeto.firebaseapp.com",
            projectId: "seu-projeto",
            storageBucket: "seu-projeto.appspot.com",
            messagingSenderId: "seu-id",
            appId: "seu-app-id"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Elementos da Interface
        const loginLink = document.getElementById('login-link');
        const userProfile = document.getElementById('user-profile');
        const userNameSpan = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');
        const userDropdown = document.getElementById('user-dropdown');

        // 1. Monitorar estado de Autenticação
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // USUÁRIO LOGADO: Troca botão pelo Perfil
                loginLink.style.display = 'none';
                userProfile.style.display = 'flex';

                try {
                    // Busca o nome real no Firestore usando o UID do usuário
                    const docRef = doc(db, "usuarios", user.uid);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        userNameSpan.innerText = docSnap.data().username;
                    } else {
                        userNameSpan.innerText = "Jogador";
                    }
                } catch (error) {
                    console.error("Erro ao buscar dados do usuário:", error);
                    userNameSpan.innerText = "Jogador";
                }
            } else {
                // USUÁRIO DESLOGADO: Mostra botão de entrar
                loginLink.style.display = 'block';
                userProfile.style.display = 'none';
            }
        });

        // 2. Lógica do Dropdown (Abrir/Fechar)
        userProfile.addEventListener('click', (e) => {
            e.stopPropagation(); // Evita que o clique feche o menu imediatamente
            const isVisible = userDropdown.style.display === 'block';
            userDropdown.style.display = isVisible ? 'none' : 'block';
        });

        // Fechar dropdown ao clicar fora dele
        window.addEventListener('click', () => {
            userDropdown.style.display = 'none';
        });

        // 3. Lógica de Logout
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).then(() => {
                alert("Você saiu da arena!");
                window.location.reload(); // Recarrega para limpar o estado da UI
            }).catch((error) => {
                console.error("Erro ao sair:", error);
            });
        });
    </script>
</body>
</html>
